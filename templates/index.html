<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Digital Inspector</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #f4f6f9;
        }
        .card {
            border-radius: 12px;
        }
        .img-box {
            max-height: 900px;
            overflow: hidden;
            border-radius: 12px;
            border: 1px solid #ddd;
            background: white;
            padding: 10px;
        }
        img {
            width: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>

<div class="container py-5">

    <h1 class="text-center mb-4">üîç Digital Inspector</h1>

    <div class="card p-4 shadow-sm">

        <form action="/" method="POST" enctype="multipart/form-data">
            <label class="form-label fw-bold">Upload a document:</label>
            <input class="form-control mb-3" type="file" name="image" required>

            <button class="btn btn-primary w-100" type="submit">
                Scan Document
            </button>
        </form>

        {% if json_zip %}
        <div class="mb-3 text-center">
            <a href="/download/{{ json_zip }}" class="btn btn-secondary" download>
                Download All JSONs (ZIP)
            </a>
        </div>
        {% endif %}


        {% if input_image_list %}
    

        <div class="row">
            <div class="col-md-6">
                <h5 class="text-center">Original</h5>
                <div class="img-box">
                    <img src="{{ input_image }}">
                </div>
            </div>
        </div>
        {% endif %}

        {% if output_image %}
        <hr class="my-4">

        <div class="row">
            <h5 class="text-center mb-3 w-100">Detection Results</h5>
            {% for img in output_image %}
            <div class="col-md-6 mb-3">
                <div class="img-box">
                    <img src="{{ img }}">
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="mt-4 text-center">
            {% for img in output_image %}
                <a href="{{ img }}" download class="btn btn-success mb-2">
                    Download Result: {{ img.split('/')[-1] }}
                </a><br>
            {% endfor %}
        </div>
        {% endif %}
        {% if results_with_time %}
        <hr class="my-4">

        <div class="row">
            <h5 class="text-center mb-3 w-100">Detection Results</h5>
            {% for img, dt in results_with_time %}
            <div class="col-md-6 mb-3">
                <div class="img-box">
                    <img src="{{ img }}">
                </div>
                <p class="text-center mt-2">Detection time: {{ dt }} s</p>
            </div>
            {% endfor %}
        </div>

        <div class="mt-4 text-center">
            {% for img, dt in results_with_time %}
                <a href="{{ img }}" download class="btn btn-success mb-2">
                    Download Result: {{ img.split('/')[-1] }}
                </a><br>
            {% endfor %}
        </div>
        {% endif %}

        {% if crops %}
        <hr class="my-4">

        <h4 class="text-center mb-3">Detected Elements</h4>

        <div class="row">
            {% for c in crops %}
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm">
                    <img src="{{ c.path }}" class="card-img-top" alt="crop">
                    <div class="card-body text-center">
                        <h6 class="card-title">{{ c.label }}</h6>
                        <p class="card-text text-muted">Confidence: {{ c.conf }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

    </div>
</div>

</body>
</html>
